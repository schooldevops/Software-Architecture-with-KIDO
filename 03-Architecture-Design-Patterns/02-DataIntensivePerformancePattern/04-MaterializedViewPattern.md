# Materialized View Pattern

## 개요 

- Materialized View Pattern은 데이터베이스에서 쿼리 결과를 저장하는 패턴으로, 데이터의 빠른 조회와 쿼리 수행 시간 단축에 유용하다. 
- Materialized View Pattern은 여러 테이블에서 데이터를 조회하여 이를 하나의 뷰(View)로 모아서 저장하는 패턴이다.
- 쿼리 결과를 미리 계산하여 뷰로 저장한다. 
- 뷰는 데이터베이스 내부의 테이블처럼 작동하며, 쿼리 결과를 저장하여 더 빠른 응답 시간을 제공한다.

![materialized-view](imgs/materialized-view-pattern-diagram.png)

## 예제

- 상품목록 조회 페이지 
  - 온라인 쇼핑몰에서 상품 목록을 조회하는 페이지가 있다. 
  - 매번 쇼핑몰 상품 테이블을 쿼리해서 상품 목록을 불러오면, 매번 상품 테이블을 전체 스캔해야 하므로 쿼리 시간이 매우 길어질 수 있다.
  - 이 경우, 상품 목록을 뷰로 만들어 두면 쿼리 시간이 훨씬 단축된다
  - 뷰에는 상품 테이블의 일부 컬럼만 포함시켜 불필요한 데이터 검색을 제거할 수도 있다.

## 뷰의 종류 

- Materialized View
  - 조회 결과를 물리적인 저장 공간에 다시 저장한다. 
  - 그 자체로 테이블이므로, 원본 데이터와 중복된 새로운 한벌이 생기는 것과 같다. 
- View
  - 일반 뷰를 의미한다. 
  - 뷰는 쿼리 결과를 저장하는 것이 아니라. 쿼리 자체를 저장하며, 조회할때 쿼리가 다시 실행된다. 
  - 데이터의 일관성이 유지되지만, 매번 조회할때마다 쿼리를 다시 실행하므로 성능상 이점은 없다. 
  - 다만 복잡한 쿼리를 Divide and Conquer 방식으로 분할 정복 할 수 있다는 장점이 있다. (유지보수 향상)


## 장점/단점 

- 장점
  - 빠른 응답 시간
    - 뷰를 미리 계산하여 저장하므로, 쿼리 시간이 훨씬 단축된다.
  - 높은 확장성
    - 뷰를 이용하여 쿼리 결과를 저장하면, 뷰를 업데이트하는 작업을 분산시켜 처리할 수 있다.
  - 데이터 일관성
    - 뷰를 이용하여 데이터를 검색하므로, 데이터 일관성이 유지된다.
  - 데이터 중복 제거
    - 뷰에서 중복되는 데이터를 제거할 수 있다.

- 단점
  - 뷰를 업데이트하는데 드는 비용: 
    - 뷰를 업데이트하는 작업은 쿼리 수행 시간에 추가적인 비용이 들기 때문에, 뷰를 업데이트할 때마다 비용을 고려해야 한다.
  - 데이터 일관성
    - 뷰를 이용하여 데이터를 검색하므로, 뷰가 정확히 업데이트되지 않으면 데이터 일관성 문제가 발생할 수 있다.
  - 데이터 저장 공간
    - 뷰를 이용하면 쿼리 결과를 물리적으로 저장하므로, 많은 저장공간이 필요하다. 

## WrapUp

- Materialized View는 쿼리 결과를 물리적인 저장 공간에 다시 저장하는 패턴이다. 
- Materialized View를 이용하면 복잡한 쿼리 (많은 조인, 테이블 전체 조인등) 이 발생되는 케이스에서 성능을 극적으로 향상시킬 수 있다. 
- 물리적으로 결과가 저장되므로 원 데이터와 데이터 일관성이 맞지 않을 수 있어 주의가 필요하다. 
- 데이터 일관성을 위한 비용과 조회 비용을 잘 고려해야한다. 

- 참고:
  - https://learn.microsoft.com/en-us/azure/architecture/patterns/materialized-view